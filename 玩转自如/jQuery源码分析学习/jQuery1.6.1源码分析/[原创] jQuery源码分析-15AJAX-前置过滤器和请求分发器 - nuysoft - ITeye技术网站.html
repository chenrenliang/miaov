<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0037)http://nuysoft.iteye.com/blog/1178483 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站</title>
    <meta name="description" content="   边读边写，不正确的地方，还请各位告诉我，多多交流共同学习。    15.4         AJAX中的前置过滤器和请求分发器  自jQuery1.5以后，AJAX模块提供了� ...">
    <meta name="keywords" content="web, javascript, ajax, 前置过滤器, 请求分发器 [原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器">
    <link rel="shortcut icon" href="http://nuysoft.iteye.com/images/favicon.ico" type="image/x-icon">
    <link rel="search" type="application/opensearchdescription+xml" href="http://nuysoft.iteye.com/open_search.xml" title="ITeye">
    <link href="http://nuysoft.iteye.com/rss" rel="alternate" title="nuysoft" type="application/rss+xml">
    <link href="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/blog.css" media="screen" rel="stylesheet" type="text/css">
<link href="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/black.css" media="screen" rel="stylesheet" type="text/css">
    <script type="text/javascript" async="" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/ga.js"></script><script type="text/javascript" async="" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/ga.js"></script><script src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/application.js" type="text/javascript"></script>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-535605-1']);
  _gaq.push(['_setDomainName', 'iteye.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


      <link href="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/SyntaxHighlighter.css" media="screen" rel="stylesheet" type="text/css">
  <script src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/shCoreCommon.js" type="text/javascript"></script>
<script src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/hotkey.js" type="text/javascript"></script>
  <script src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/code_favorites.js" type="text/javascript"></script>
<script src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/weiboshare.js" type="text/javascript"></script>
  <link href="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/ui.css" media="screen" rel="stylesheet" type="text/css">
  <script src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/compress.js" type="text/javascript"></script>
  <style type="text/css">.dp-j .annotation { color: #646464; }.dp-j .number { color: #C00000; }</style></head>
  <body>
    <div id="header">
      <div id="blog_site_nav">
  <a href="http://www.iteye.com/" class="homepage">首页</a>
  <a href="http://www.iteye.com/news">资讯</a>
  <a href="http://www.iteye.com/magazines">精华</a>
  <a href="http://www.iteye.com/forums">论坛</a>
  <a href="http://www.iteye.com/ask">问答</a>
  <a href="http://www.iteye.com/blogs">博客</a>
  <a href="http://www.iteye.com/blogs/subjects">专栏</a>
  <a href="http://www.iteye.com/groups">群组</a>
  <a href="http://nuysoft.iteye.com/blog/1178483#" onclick="return false;" id="msna"><u>更多</u> <small>▼</small></a>
  <div class="quick_menu" style="display:none;">
    <a target="_blank" href="http://job.iteye.com/iteye">招聘</a>
    <a href="http://www.iteye.com/search">搜索</a>
  </div>
</div>

      <div id="user_nav">
  
        <a href="http://hhy5277.iteye.com/" title="查看我的博客首页" class="welcome">欢迎hhy5277</a>
    <a id="notifications_count" href="http://my.iteye.com/notifications" class="" title="没有未读消息">0</a>
    
      <a href="http://my.iteye.com/messages" title="你有新的站内短信"><img alt="Newpm" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/newpm.gif">收件箱(2)</a>
    
    <a href="http://my.iteye.com/" title="我的应用首页">我的应用</a>
    <div class="quick_menu" style="display:none;">
      <a href="http://my.iteye.com/feed" title="我关注的好友动态消息">我的关注</a>
      <a href="http://my.iteye.com/mygroup" title="我加入的群组最新话题">我的群组</a>
      <a href="http://my.iteye.com/myresume" title="我的个人简历">我的简历</a>
      <a href="http://my.iteye.com/admin/album" title="我的个人简历">我的相册</a>
      <a href="http://my.iteye.com/admin/link" title="我收藏的网络资源链接">我的收藏</a>
      <a href="http://my.iteye.com/admin/code" title="我收藏的代码">我的代码</a>
      <a href="http://my.iteye.com/admin/weibo" title="用微博发表简短的话题">我的微博</a>
    </div>
    <a href="http://hhy5277.iteye.com/admin" title="管理我的博客">我的博客</a>
    <a href="http://my.iteye.com/profile" title="修改我的个人设置">设置</a>
    <a href="http://nuysoft.iteye.com/logout" class="nobg" onclick="var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var m = document.createElement(&#39;input&#39;); m.setAttribute(&#39;type&#39;, &#39;hidden&#39;); m.setAttribute(&#39;name&#39;, &#39;_method&#39;); m.setAttribute(&#39;value&#39;, &#39;put&#39;); f.appendChild(m);var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;foncspGUjo88KbEH23TBNwmOVJHI8suaVg9RqM0afpk=&#39;); f.appendChild(s);f.submit();return false;">退出</a>
  </div>

    </div>

    <div id="page">
      <div id="branding" class="clearfix">
        <div id="blog_name">
          <h1><a href="http://nuysoft.iteye.com/">nuysoft</a></h1>
        </div>
        <div id="fd"></div>
        <div id="blog_navbar">
          <ul>
            <li class="blog_navbar_for"><a href="http://nuysoft.iteye.com/"><strong>博客</strong></a></li>
            <li><a href="http://nuysoft.iteye.com/weibo">微博</a></li>
            <li><a href="http://nuysoft.iteye.com/album">相册</a></li>
            <li><a href="http://nuysoft.iteye.com/link">收藏</a></li>
            <li><a href="http://nuysoft.iteye.com/blog/guest_book">留言</a></li>
            <li><a href="http://nuysoft.iteye.com/blog/profile">关于我</a></li>
          </ul>
    
          <div class="search">
            <form action="http://nuysoft.iteye.com/blog/search" method="get">
              <input class="search_text" id="query" name="query" style="margin-left: 10px;width: 110px;" type="text" value="">
              <input class="submit_search" type="submit" value="">
            </form>
          </div> 
          <div id="fd"></div>         
        </div>
      </div>
      
      <div id="content" class="clearfix">
        <div id="main">
          



          


<div class="h-entry" style="display:none">
  <a href="http://nuysoft.iteye.com/" class="p-author" target="_blank">nuysoft</a>
</div>


<div class="blog_main">
  <div class="blog_title">
    <h3>
      <a href="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站.html">[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器</a>
      <em class="actions">      </em>
    </h3>
    <ul class="blog_categories"><strong>博客分类：</strong> <li><a href="http://nuysoft.iteye.com/category/140986">jQuery</a></li> </ul>
        <div class="news_tag"><a href="http://www.iteye.com/blogs/tag/web">web</a><a href="http://www.iteye.com/blogs/tag/javascript">javascript</a><a href="http://www.iteye.com/blogs/tag/ajax">ajax</a><a href="http://www.iteye.com/blogs/tag/%E5%89%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8">前置过滤器</a><a href="http://www.iteye.com/blogs/tag/%E8%AF%B7%E6%B1%82%E5%88%86%E5%8F%91%E5%99%A8">请求分发器</a>&nbsp;</div>
  </div>

  <div id="blog_content" class="blog_content">
    <p>&nbsp;</p>
<h2><span style="font-size: 12px; font-weight: normal;"><a name="OLE_LINK58"><span>边读边写，不正确的地方，还请各位告诉我，多多交流共同学习。</span></a></span></h2>
<h2>
<span><span>15.4<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span>AJAX</span>中的前置过滤器和请求分发器</h2>
<p class="MsoNormal">自<span>jQuery1.5</span>以后，<span>AJAX</span>模块提供了三个新的方法用于管理、扩展<span>AJAX</span>请求，分别是：</p>
<p class="MsoListParagraph"><span style="font-family: Wingdings;"><span>l<span style="">&nbsp; </span></span></span>前置过滤器<span> <a name="OLE_LINK40"></a><a name="OLE_LINK39"><span>jQuery. ajaxPrefilter</span></a></span></p>
<p class="MsoListParagraph"><span style="font-family: Wingdings;"><span>l<span style="">&nbsp; </span></span></span>请求分发器
<span>jQuery. ajaxTransport</span>，</p>
<p class="MsoListParagraph"><span style="font-family: Wingdings;"><span>l<span style="">&nbsp; </span></span></span>类型转换器
<span>ajaxConvert</span></p>
<p class="MsoNormal">这里先分析前置过滤器和请求分发器，类型转换器下一节再讲。</p>
<h3>
<span><span>15.4.1<span style="">&nbsp; </span></span></span>前置过滤器和请求分发器的初始化</h3>
<p class="MsoNormal">前置过滤器和请求分发器在执行时，分别遍历内部变量<span>prefilters</span>和<a name="OLE_LINK46"></a><a name="OLE_LINK45"><span><span>transports</span></span></a>，这两个变量在<span>jQuery</span>加载完毕后立即初始化，初始化的过程很有意思。</p>
<p class="MsoNormal"><strong><span style="font-size: 12.0pt;">首先</span></strong>，<span>prefilters</span>和<span>transports</span>被置为空对象：</p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0"><tbody><tr>
<td style="width: 780.7pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="1041">
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">prefilters = {}, </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">过滤器</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">transports = {}, </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">分发器</span></p>
</td>
</tr></tbody></table>
<p class="MsoNormal"><strong><span style="font-size: 12.0pt;">然后</span></strong>，创建<a name="OLE_LINK50"></a><a name="OLE_LINK49"><span><span>jQuery.ajaxPrefilter</span>和<span>jQuery.ajaxTransport</span></span></a>，这两个方法都调用了内部函数<span style="font-size: 11.0pt; font-family: Consolas; color: black;">addToPrefiltersOrTransports</span><span style="font-size: 11.0pt; color: black;">，</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">addToPrefiltersOrTransports</span><span style="font-size: 11.0pt; color: black;">返回一个匿名闭包函数，这个匿名闭包函数负责将单一前置过滤和单一请求分发器分别放入</span><a name="OLE_LINK52"></a><a name="OLE_LINK51"><span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">prefilters</span></span></a><span><span><span style="font-size: 11.0pt; color: black;">和</span></span></span><span><span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">transports</span></span></span><span style="font-size: 11.0pt; color: black;">。我们知道闭包会保持对它所在环境变量的引用，而</span><span>jQuery.ajaxPrefilter</span>和<span>jQuery.ajaxTransport</span><span style="font-size: 11.0pt; color: black;">的实现又完全一样</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">,</span><span style="font-size: 11.0pt; color: black;">都是对</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">Map</span><span style="font-size: 11.0pt; color: black;">结构的对象进行赋值操作</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">,</span><span style="font-size: 11.0pt; color: black;">因此这里利用闭包的特性巧妙的将两个方法的实现合二为一。函数</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">addToPrefiltersOrTransports</span><span style="font-size: 11.0pt; color: black;">可视为模板模式的一种实现。</span></p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0"><tbody><tr>
<td style="width: 780.7pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="1041">
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">ajaxPrefilter: <a name="OLE_LINK48"></a><a name="OLE_LINK47"><span>addToPrefiltersOrTransports</span></a>(
  prefilters ), </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">通过闭包保持对</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">prefilters</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">的引用，将前置过滤器添加到</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">prefilters</span></span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">ajaxTransport: addToPrefiltersOrTransports(
  transports ), </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">通过闭包保持对</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">transports</span><span style="font-size: 11.0pt; color: #3f7f5f;">的引用，将请求分发器添加到</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">transports</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">添加全局前置过滤器或请求分发器，过滤器的在发送之前调用，分发器用来区分</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">ajax</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">请求和</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">标签请求</span></p>
<p class="MsoNormal" style="text-align: left;"><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> addToPrefiltersOrTransports( structure ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">通过闭包访问</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">structure</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">之所以能同时支持</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">Prefilters</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">和</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">Transports</span><span style="font-size: 11.0pt; color: #3f7f5f;">，关键在于</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">structure</span><span style="font-size: 11.0pt; color: #3f7f5f;">引用的时哪个对象</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">//
  dataTypeExpression is optional and defaults to "*"</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">//
  dataTypeExpression</span><span style="font-size: 11.0pt; color: #3f7f5f;">是可选参数，默认为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">*</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">return</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( dataTypeExpression, func ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">修正参数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">typeof</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> dataTypeExpression !== </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"string"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>func = dataTypeExpression;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>dataTypeExpression = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"*"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( jQuery.isFunction( func ) ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> dataTypes =
  dataTypeExpression.toLowerCase().split( rspacesAjax ), </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">用空格分割数据类型表达式</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">dataTypeExpression</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>i = 0,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>length = dataTypes.length,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>dataType,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>list,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>placeBefore;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// For each dataType in the dataTypeExpression</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">for</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">(; i &lt; length; i++ ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>dataType = dataTypes[ i ];</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// We control if we're asked to add before</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// any existing element</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果以</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">+</span><span style="font-size: 11.0pt; color: #3f7f5f;">开头，过滤</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">+</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>placeBefore = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">/^\+/</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">.test( dataType );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( placeBefore ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>dataType = dataType.substr(
  1 ) || </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"*"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>list = structure[ dataType ] =
  structure[ dataType ] || [];</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// then we add to the structure accordingly</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果以</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">+</span><span style="font-size: 11.0pt; color: #3f7f5f;">开头，则插入开始位置，否则添加到末尾</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">实际上操作的是</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">structure</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>list[ placeBefore ? </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"unshift"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> : </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"push"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ]( func );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>};</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">}</span></p>
</td>
</tr></tbody></table>
<p class="MsoNormal"><strong><span style="font-size: 12.0pt;">最后</span></strong>，分别调用<span>jQuery.ajaxPrefilter</span>和<span>jQuery.ajaxTransport</span>填充<span style="font-size: 11.0pt; font-family: Consolas; color: black;">prefilters</span><span style="font-size: 11.0pt; color: black;">和</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">transports.</span></p>
<p class="MsoNormal"><strong><span style="font-size: 12.0pt;">填充</span></strong><strong><span style="font-size: 12.0pt; font-family: Consolas; color: black;">prefilters:</span></strong></p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0"><tbody><tr>
<td style="width: 780.7pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="1041">
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Detect, normalize
  options and install <span style="text-decoration: underline;">callbacks</span> for <span style="text-decoration: underline;">jsonp</span> requests</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">向前置过滤器对象中添加特定类型的过滤器</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">添加的过滤器将格式化参数，并且为</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">请求增加</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">callbacks</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// MARK</span><span style="font-size: 11.0pt; color: #3f7f5f;">：</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">AJAX</span><span style="font-size: 11.0pt; color: #3f7f5f;">模块初始化</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">jQuery.ajaxPrefilter( </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"json jsonp"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">, </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( s, originalSettings, jqXHR ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> inspectData = s.contentType === </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"application/x-www-form-urlencoded"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> &amp;&amp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>( </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">typeof</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> s.data === </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"string"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果是表单提交，则需要检查数据</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">这个方法只处理</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">，如果</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">json</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">的</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">url</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">或</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">data</span><span style="font-size: 11.0pt; color: #3f7f5f;">有</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">的特征，会被当成</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">处理</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">触发</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">的</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">3</span><span style="font-size: 11.0pt; color: #3f7f5f;">种方式：</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.dataTypes[ 0 ] === </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"jsonp"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> || </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果是</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.jsonp !== </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">false</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> &amp;&amp; ( jsre.test( s.url )
  || </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">未禁止</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">，</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">s.url</span><span style="font-size: 11.0pt; color: #3f7f5f;">中包含</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">=?&amp; =?$ ??</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>inspectData &amp;&amp;
  jsre.test( s.data ) ) ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// s.data</span><span style="font-size: 11.0pt; color: #3f7f5f;">中包含</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">=?&amp; =?$ ??</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> responseContainer,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>jsonpCallback = s.jsonpCallback =</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>jQuery.isFunction(
  s.jsonpCallback ) ? s.jsonpCallback() : s.jsonpCallback, </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// s.jsonpCallback</span><span style="font-size: 11.0pt; color: #3f7f5f;">时函数，则执行函数用返回值做为回调函数名</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>previous = window[ jsonpCallback ],</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>url = s.url,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>data = s.data,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">jsre</span> = /(\=)\?(&amp;|$)|\?\?/i; // =?&amp; =?$ ??</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>replace = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"$1"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> + jsonpCallback + </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"$2"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// $1 =, $2 &amp;|$</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.jsonp !== </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">false</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>url = url.replace( jsre, replace );
  </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">将回调函数名插入</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">url</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.url === url ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">url</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">没有变化，则尝试修改</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">data</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( inspectData ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>data = data.replace( jsre,
  replace ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">将回调函数名插入</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">data</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.data === data ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">data</span><span style="font-size: 11.0pt; color: #3f7f5f;">也没有变化</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Add <span style="text-decoration: underline;">callback</span> manually</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>url += (</span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">/\?/</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">.test( url ) ? </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"&amp;"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> : </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"?"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">) + s.jsonp + </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"="</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> + jsonpCallback; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">自动再</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">url</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">后附加回调函数名</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">存储可能改变过的</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">url</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">、</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">data</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.url = url;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.data = data;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Install <span style="text-decoration: underline;">callback</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>window[ jsonpCallback ] = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( response ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">在</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">window</span><span style="font-size: 11.0pt; color: #3f7f5f;">上注册回调函数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>responseContainer = [ response ];</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Clean-up function</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>jqXHR.always(</span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">() {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Set <span style="text-decoration: underline;">callback</span> back to previous value</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">将备份的</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">previous</span><span style="font-size: 11.0pt; color: #3f7f5f;">函数恢复</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>window[ jsonpCallback ] = previous;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Call if it was a function and we have a response</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">响应完成时调用</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">回调函数，问题是这个函数不是自动执行的么？</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( responseContainer &amp;&amp;
  jQuery.isFunction( previous ) ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>window[ jsonpCallback ](
  responseContainer[ 0 ] ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">为什么要再次执行</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">previous</span><span style="font-size: 11.0pt; color: #3f7f5f;">呢？</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>});</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Use data converter to retrieve <span style="text-decoration: underline;">json</span> after script execution</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.converters[</span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"script json"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">] = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">() {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !responseContainer ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>jQuery.error( jsonpCallback + </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">" was not called"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">return</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> responseContainer[ 0 ]; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">因为是作为方法的参数传入，本身就是一个</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">json</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">对象，不需要再做转换</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// force <span style="text-decoration: underline;">json</span> dataType</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.dataTypes[ 0 ] = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"json"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">强制为</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">json</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Delegate to script</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">return</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"script"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">jsonp</span> &gt; <span style="text-decoration: underline;">json</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">});</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Handle cache's
  special case and global</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">设置</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">的前置过滤器，</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">并不一定意思着跨域</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// MARK</span><span style="font-size: 11.0pt; color: #3f7f5f;">：</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">AJAX</span><span style="font-size: 11.0pt; color: #3f7f5f;">模块初始化</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">jQuery.ajaxPrefilter( </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"script"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">, </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( s ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.cache === </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">undefined</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果缓存未设置，则设置</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">false</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.cache = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">false</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.crossDomain ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">跨域未被禁用，强制类型为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">GET</span><span style="font-size: 11.0pt; color: #3f7f5f;">，不触发全局时间</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.type = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"GET"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>s.global = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">false</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">});</span></p>
</td>
</tr></tbody></table>
<p class="MsoNormal"><strong><span style="font-size: 12.0pt;">填充</span></strong><strong><span style="font-size: 12.0pt; font-family: Consolas; color: black;">transports</span></strong><strong><span style="font-size: 12.0pt; color: black;">：</span></strong><strong></strong></p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0"><tbody><tr>
<td style="width: 780.7pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="1041">
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Bind script tag
  hack transport</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">绑定</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">分发器</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">通过在</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">header</span><span style="font-size: 11.0pt; color: #3f7f5f;">中创建</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">标签异步载入</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">js</span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">实现过程很简介</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// MARK</span><span style="font-size: 11.0pt; color: #3f7f5f;">：</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">AJAX</span><span style="font-size: 11.0pt; color: #3f7f5f;">模块初始化</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">jQuery.ajaxTransport( </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"script"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">, </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">(s) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// This
  transport only deals with cross domain requests</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.crossDomain ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// script</span><span style="font-size: 11.0pt; color: #3f7f5f;">可能时</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">json</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">或</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">，</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">jsonp</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">需要跨域，</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">ajax</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">模块大约有</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">1/3</span><span style="font-size: 11.0pt; color: #3f7f5f;">的代码时跨域的</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果在本域中设置了跨域会怎么处理呢？</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> script,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>head = document.head ||
  document.getElementsByTagName( </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"head"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> )[0] || document.documentElement; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">充分利用布尔表达式的计算顺序</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">return</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>send: </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( _, callback ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">提供与同域请求一致的接口</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script = document.createElement(
  </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"script"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">通过创</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">标签来实现</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script.async = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"async"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.scriptCharset ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script.charset =
  s.scriptCharset; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">字符集</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script.src = s.url; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">动态载入</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Attach handlers for all browsers</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script.onload =
  script.onreadystatechange = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( _, isAbort ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( isAbort || !script.readyState ||
  /loaded|complete/.test( script.readyState ) ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Handle memory leak in IE</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script.onload =
  script.onreadystatechange = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">null</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">onload</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">事件触发后，销毁事件句柄，因为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">IE</span><span style="font-size: 11.0pt; color: #3f7f5f;">内存泄漏？</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Remove the script</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( head &amp;&amp;
  script.parentNode ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>head.removeChild(
  script ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">onloda</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">后，删除</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">节点</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Dereference the script</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">undefined</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">注销</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">script</span><span style="font-size: 11.0pt; color: #3f7f5f;">变量</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">Callback</span> if not abort</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !isAbort ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>callback( 200, </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"success"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">执行回调函数，</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">200</span><span style="font-size: 11.0pt; color: #3f7f5f;">为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">HTTP</span><span style="font-size: 11.0pt; color: #3f7f5f;">状态码</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Use insertBefore instead of appendChild<span>&nbsp; </span>to circumvent an IE6 bug.</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// This arises when a base node is used (#2709 and #4378).</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">用</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">insertBefore</span><span style="font-size: 11.0pt; color: #3f7f5f;">代替</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">appendChild</span><span style="font-size: 11.0pt; color: #3f7f5f;">，如果</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">IE6</span><span style="font-size: 11.0pt; color: #3f7f5f;">的</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">bug</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>head.insertBefore( script,
  head.firstChild ); </span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>},</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>abort: </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">() {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( script ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>script.onload( 0, 1 ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">手动触发</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">onload</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">事件</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,jqXHR</span><span style="font-size: 11.0pt; color: #3f7f5f;">状态码为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">0,HTTP</span><span style="font-size: 11.0pt; color: #3f7f5f;">状态码为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">1xx</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">});</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Create transport
  if the browser can provide an <span style="text-decoration: underline;">xhr</span></span></p>
<p class="MsoNormal" style="text-align: left;"><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( jQuery.support.ajax ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// MARK</span><span style="font-size: 11.0pt; color: #3f7f5f;">：</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">AJAX</span><span style="font-size: 11.0pt; color: #3f7f5f;">模块初始化</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">普通</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">AJAX</span><span style="font-size: 11.0pt; color: #3f7f5f;">请求分发器，</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">dataType</span><span style="font-size: 11.0pt; color: #3f7f5f;">默认为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">*</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>jQuery.ajaxTransport(</span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( s ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// *</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Cross domain only allowed if supported through XMLHttpRequest</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果不是跨域请求，或支持身份验证</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !s.crossDomain || jQuery.support.cors )
  {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> callback;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">return</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>send: </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( headers,
  complete ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Get a new <span style="text-decoration: underline;">xhr</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">创建一个</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">XHR</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> xhr = s.xhr(),</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>handle,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>i;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Open the socket</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Passing null <span style="text-decoration: underline;">username</span>, generates a login <span style="text-decoration: underline;">popup</span> on Opera
  (#2865)</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">调用</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">XHR</span><span style="font-size: 11.0pt; color: #3f7f5f;">的</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">open</span><span style="font-size: 11.0pt; color: #3f7f5f;">方法</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.username ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.open( s.type, s.url,
  s.async, s.username, s.password ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果需要身份验证</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">else</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.open( s.type, s.url,
  s.async );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Apply custom fields if provided</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">在</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">XHR</span><span style="font-size: 11.0pt; color: #3f7f5f;">上绑定自定义属性</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.xhrFields ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">for</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( i </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">in</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> s.xhrFields ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr[ i ] =
  s.xhrFields[ i ];</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Override <span style="text-decoration: underline;">mime</span> type if needed</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果有必要的话覆盖</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">mineType,overrideMimeType</span><span style="font-size: 11.0pt; color: #3f7f5f;">并不是一个标准接口</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">因此需要做特性检测</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( s.mimeType &amp;&amp;
  xhr.overrideMimeType ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.overrideMimeType(
  s.mimeType );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// X-Requested-With header</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// For cross-domain requests, seeing as conditions for a <span style="text-decoration: underline;">preflight</span>
  are</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// akin to a <span style="text-decoration: underline;">jigsaw</span> puzzle, we simply never set it to be sure.</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// (it can always be set on a per-request basis or even using ajaxSetup)</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// For same-domain requests, won't change header if already provided.</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// X-Requested-With</span><span style="font-size: 11.0pt; color: #3f7f5f;">同样不是一个标注</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">HTTP</span><span style="font-size: 11.0pt; color: #3f7f5f;">头</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">主要用于标识</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">Ajax</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">请求</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">.</span><span style="font-size: 11.0pt; color: #3f7f5f;">大部分</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">JavaScript</span><span style="font-size: 11.0pt; color: #3f7f5f;">框架将这个头设置为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">XMLHttpRequest</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !s.crossDomain &amp;&amp; !headers[</span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"X-Requested-With"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">] ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>headers[ </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"X-Requested-With"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ] = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"XMLHttpRequest"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Need an extra try/catch for cross domain requests in <span style="text-decoration: underline;">Firefox</span> 3</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">设置请求头</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">try</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">for</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( i </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">in</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> headers ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.setRequestHeader(
  i, headers[ i ] );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">catch</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( _ ) {}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Do send the request</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// This may raise an exception which is actually</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// handled in jQuery.ajax (so no try/catch here)</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">调用</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">XHR</span><span style="font-size: 11.0pt; color: #3f7f5f;">的</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">send</span><span style="font-size: 11.0pt; color: #3f7f5f;">方法</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.send( ( s.hasContent
  &amp;&amp; s.data ) || </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">null</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Listener</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">封装回调函数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>callback = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( _, isAbort )
  {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> status,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>statusText,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>responseHeaders,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>responses, </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">响应内容</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">格式为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">text:text, xml:xml</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xml;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">Firefox</span> throws exceptions when accessing properties</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// of an <span style="text-decoration: underline;">xhr</span> when a network error <span style="text-decoration: underline;">occured</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">//
  http://helpful.knobs-dials.com/index.php/Component_returned_failure_code:_0x80040111_(NS_ERROR_NOT_AVAILABLE)</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">在</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">FF</span><span style="font-size: 11.0pt; color: #3f7f5f;">下当网络异常时</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">访问</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">XHR</span><span style="font-size: 11.0pt; color: #3f7f5f;">的属性会抛出异常</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">try</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Was never called and is aborted or complete</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( callback &amp;&amp;
  ( isAbort || xhr.readyState === 4 ) ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// 4</span><span style="font-size: 11.0pt; color: #3f7f5f;">表示响应完成</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Only called once</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>callback = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">undefined</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">callback</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">只调用一次</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">注销</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">callback</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Do not keep as active anymore</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( handle ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.onreadystatechange
  = jQuery.noop; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">将</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">onreadystatechange</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">句柄重置为空函数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( xhrOnUnloadAbort )
  { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果是界面退出导致本次请求取消</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">delete</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> xhrCallbacks[
  handle ]; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">注销句柄</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// If it's an abort</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( isAbort ) { </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果是取消本次请求</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Abort it manually if needed</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( xhr.readyState !==
  4 ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.abort();
  </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">调用</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">xhr</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">原生的</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">abort</span><span style="font-size: 11.0pt; color: #3f7f5f;">方法</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">else</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>status =
  xhr.status;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>responseHeaders
  = xhr.getAllResponseHeaders();</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>responses =
  {};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xml =
  xhr.responseXML;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Construct response list</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( xml &amp;&amp;
  xml.documentElement </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">/* #4958 */</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>responses.xml
  = xml; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">提取</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">xml</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>responses.text
  = xhr.responseText; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">提取</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">text</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// <span style="text-decoration: underline;">Firefox</span> throws an exception when accessing</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// statusText for faulty cross-domain requests</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// FF</span><span style="font-size: 11.0pt; color: #3f7f5f;">在跨域请求中访问</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">statusText</span><span style="font-size: 11.0pt; color: #3f7f5f;">会抛出异常</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">try</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>statusText
  = xhr.statusText;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">catch</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">( e ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// We normalize with <span style="text-decoration: underline;">Webkit</span> giving an empty
  statusText</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>statusText
  = </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">""</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">像</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">WebKit</span><span style="font-size: 11.0pt; color: #3f7f5f;">一样将</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">statusText</span><span style="font-size: 11.0pt; color: #3f7f5f;">置为空字符串</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Filter status for non standard behaviors</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// If the request is local and we have data: assume a
  success</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// (success with no data won't get notified, that's the
  best we</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// can do given current implementations)</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">过滤不标准的服务器状态码</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !status &amp;&amp;
  s.isLocal &amp;&amp; !s.crossDomain ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>status =
  responses.text ? 200 : 404; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// IE - #1450: sometimes returns 1223 when it should be
  204</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// 204 No Content</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">else</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( status === 1223 ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>status =
  204;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">catch</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">(
  firefoxAccessException ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !isAbort ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>complete( -1,
  firefoxAccessException ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">手动调用回调函数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Call complete if needed</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">在回调函数的最后</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">如果请求完成</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">立即调用回调函数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( responses ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>complete( status,
  statusText, responses, responseHeaders );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// if we're in sync mode or it's in cache</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// and has been retrieved directly (IE6 &amp; IE7)</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// we need to manually fire the <span style="text-decoration: underline;">callback</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">同步模式下</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">:</span><span style="font-size: 11.0pt; color: #3f7f5f;">同步导致阻塞一致到服务器响应完成</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">所以这里可以立即调用</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">callback</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !s.async || xhr.readyState === 4 ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>callback();</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">else</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>handle = ++xhrId; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">请求计数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果时页面退出导致本次请求取消</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">修正在</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">IE</span><span style="font-size: 11.0pt; color: #3f7f5f;">下不断开连接的</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">bug</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( xhrOnUnloadAbort )
  {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Create the active <span style="text-decoration: underline;">xhrs</span> <span style="text-decoration: underline;">callbacks</span> list
  if needed</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// and attach the unload handler</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !xhrCallbacks ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhrCallbacks = {};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>jQuery( window
  ).unload( xhrOnUnloadAbort ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">手动触发页面销毁事件</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Add to list of active <span style="text-decoration: underline;">xhrs</span> <span style="text-decoration: underline;">callbacks</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">将回调函数存储在全局变量中</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">以便在响应完成或页面退出时能注销回调函数</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhrCallbacks[ handle
  ] = callback;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>xhr.onreadystatechange =
  callback; </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">绑定句柄</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,</span><span style="font-size: 11.0pt; color: #3f7f5f;">这里和传统的</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">ajax</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">写法没什么区别</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>},</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>abort: </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">() {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( callback ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>callback(0,1); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// 1</span><span style="font-size: 11.0pt; color: #3f7f5f;">表示调用</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">callback</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">时</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">,isAbort</span><span style="font-size: 11.0pt; color: #3f7f5f;">为</span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">true,</span><span style="font-size: 11.0pt; color: #3f7f5f;">在</span><span style="text-decoration: underline;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">callback</span></span><span style="font-size: 11.0pt; color: #3f7f5f;">执行过程中能区分出是响应完成还是取消导致的调用</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>});</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">}</span></p>
</td>
</tr></tbody></table>
<h3>
<span><span>15.4.2<span style="">&nbsp; </span></span></span>前置过滤器和请求分发器的执行过程</h3>
<p class="MsoNormal"><span>prefilters</span>中的前置过滤器在请求发送之前、设置请求参数的过程中被调用，调用<span>prefilters</span>的是函数<span>inspectPrefiltersOrTransports</span>；巧妙的时，<span>transports</span>中的请求分发器在大部分参数设置完成后，也通过函数<span>inspectPrefiltersOrTransports</span>取到与请求类型匹配的请求分发器：</p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0"><tbody><tr>
<td style="width: 780.7pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="1041">
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// some code...</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Apply <span style="text-decoration: underline;">prefilters</span></span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">应用前置过滤器，参数说明：</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">inspectPrefiltersOrTransports(
  prefilters, s, options, jqXHR );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><a name="OLE_LINK55"></a><a name="OLE_LINK54"><span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span></span></a><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">If request was aborted inside a <span style="text-decoration: underline;">prefiler</span>, stop
  there</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">如果请求已经结束，直接返回</span></p>
<p class="MsoNormal" style="text-align: left;"><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( state === 2 ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">return</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">false</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">}</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// some code...</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">注意：从这里开始要发送了</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Get transport</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">请求分发器</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">transport = <a name="OLE_LINK57"></a><a name="OLE_LINK56"><span>inspectPrefiltersOrTransports</span></a>(
  transports, s, options, jqXHR );</span></p>
<p class="MsoNormal"><span>&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// some code...</span></p>
</td>
</tr></tbody></table>
<p class="MsoNormal">函数<span style="font-size: 11.0pt; font-family: Consolas; color: black;">inspectPrefiltersOrTransports</span><span style="font-size: 11.0pt; color: black;">从</span><span>prefilters</span>或<span>transports</span>中取到与数据类型匹配的函数数组<span>,</span>然后遍历执行，看看它<span style="font-size: 11.0pt; color: black;">的实现：</span></p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0"><tbody><tr>
<td style="width: 780.7pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="1041">
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// Base inspection
  function for <span style="text-decoration: underline;">prefilters</span> and transports</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">执行前置过滤器或获取请求分发器</span></p>
<p class="MsoNormal" style="text-align: left;"><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">function</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> inspectPrefiltersOrTransports( structure, options,
  originalOptions, jqXHR,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>dataType </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">/* internal */</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">, inspected </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">/* internal */</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>dataType = dataType || options.dataTypes[
  0 ];</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>inspected = inspected || {};</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>inspected[ dataType ] = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">true</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">var</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> list = structure[ dataType ],</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>i = 0,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>length = list ? list.length : 0,</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>executeOnly = ( structure ===
  prefilters ),</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>selection;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas;">&nbsp;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">for</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">(; i &lt; length &amp;&amp; ( executeOnly
  || !selection ); i++ ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>selection = list[ i ]( options,
  originalOptions, jqXHR ); </span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// </span><span style="font-size: 11.0pt; color: #3f7f5f;">遍历执行</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// If we got redirected to another dataType</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// we try there if executing only and not done already</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">typeof</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> selection === </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"string"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( !executeOnly || inspected[ selection ] )
  {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>selection = </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">undefined</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;">;</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} </span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">else</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>options.dataTypes.unshift(
  selection );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>selection =
  inspectPrefiltersOrTransports(</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>structure, options,
  originalOptions, jqXHR, selection, inspected );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// If we're
  only executing or nothing was selected</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// we try the
  <span style="text-decoration: underline;">catchall</span> dataType if not done already</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">if</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ( ( executeOnly || !selection ) &amp;&amp;
  !inspected[ </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"*"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> ] ) {</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>selection =
  inspectPrefiltersOrTransports(</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>structure, options,
  originalOptions, jqXHR, </span><span style="font-size: 11.0pt; font-family: Consolas; color: #2a00ff;">"*"</span><span style="font-size: 11.0pt; font-family: Consolas; color: black;">, inspected );</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span>}</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">//
  unnecessary when only executing (<span style="text-decoration: underline;">prefilters</span>)</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 11.0pt; font-family: Consolas; color: #3f7f5f;">// but it'll
  be ignored by the caller in that case</span></p>
<p class="MsoNormal" style="text-align: left;"><span style="font-size: 11.0pt; font-family: Consolas; color: black;"><span>&nbsp;&nbsp;&nbsp; </span></span><strong><span style="font-size: 11.0pt; font-family: Consolas; color: #7f0055;">return</span></strong><span style="font-size: 11.0pt; font-family: Consolas; color: black;"> selection;</span></p>
<p class="MsoNormal"><span style="font-size: 11.0pt; font-family: Consolas; color: black;">}</span></p>
</td>
</tr></tbody></table>
<h3>
<span><span>15.4.3<span style="">&nbsp; </span></span></span>总结</h3>
<p class="MsoNormal">通过前面的源码解析，可以将前置过滤器和请求分发器总结如下：</p>
<p class="MsoNormal"><strong><span style="font-size: 12.0pt;">前置过滤器 <span>jQuery.ajaxPrefilter</span>，<span>prefilters</span></span></strong></p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0">
<tbody><tr>
<td style="padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">属性</p>
</td>
<td style="border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">值</p>
</td>
<td style="border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">功能</p>
</td>
</tr>
<tr>
<td style="border-top: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>*</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>undefined</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">不做任何处理，事实上也没有<span>*</span>属性</p>
</td>
</tr>
<tr>
<td style="border-top: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>json</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>[ function ]</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">被当作<span>*</span>处理</p>
</td>
</tr>
<tr>
<td style="border-top: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>jsonp</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>[ function ]</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">修正<span>url</span>或<span>data</span>，增加回调函数名</p>
<p class="MsoNormal">在<span>window</span>上注册回调函数</p>
<p class="MsoNormal">注册<span>script&gt;json</span>数据转换器</p>
<p class="MsoNormal">（被当作<span>script</span>处理）</p>
</td>
</tr>
<tr>
<td style="border-top: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>script</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>[ function ]</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">设置设置以下参数：</p>
<p class="MsoNormal">是否缓存<span> cache</span>、（如果跨域）请求类型 、（如果跨域）是否触发<span>AJAX</span>全局事件</p>
</td>
</tr>
</tbody></table>
<p class="MsoNormal"><strong><span style="font-size: 12.0pt;">请求分发器 <span>jQuery.ajaxTransport</span>，<span>transports</span></span></strong></p>
<table class="MsoTableGrid" cellspacing="0" border="1" style="border-collapse: collapse; border: none;" cellpadding="0">
<tbody><tr>
<td style="padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">属性</p>
</td>
<td style="border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">值</p>
</td>
<td style="border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">功能</p>
</td>
</tr>
<tr>
<td style="border-top: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>*</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>[ function ]</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">返回<span>xhr</span>分发器，分发器带有<span>send</span>、<span>abort</span>方法</p>
<p class="MsoNormal"><span>send</span>方法依次调用<span>XMLHTTPRequest</span>的<span>open</span>、<span>send</span>方法，向服务端发送请求，并绑定<span>onreadystatechange</span>事件句柄</p>
</td>
</tr>
<tr>
<td style="border-top: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>script</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal"><span>[ function ]</span></p>
</td>
<td style="border-top: none; border-left: none; padding: 0cm 5.4pt 0cm 5.4pt;">
<p class="MsoNormal">返回<span>script</span>分发器，分发器带有<span>send</span>、<span>abort</span>方法</p>
<p class="MsoNormal"><span>send</span>方法通过在<span>header</span>中创建<span>script</span>标签异步载入<span>js</span>，并在<span>script</span>元素上绑定<span>onload</span>、<span>script.onreadystatechange</span>事件句柄</p>
</td>
</tr>
</tbody></table>
<p class="MsoNormal"><span>&nbsp;</span></p>
<p class="MsoNormal"><a name="OLE_LINK59"></a></p>
  </div>

  
  <div class="attachments">
    
      
        <ul>
          <li><a href="http://dl.iteye.com/topics/download/09891435-cddd-3e12-a871-c225ae9ff268">_原创__jQuery源码分析-15AJAX-前置过滤器和请求分发器.pdf</a> (411.5 KB)</li>
          
          <li>下载次数: 74</li>
        </ul>
      
    
    
  </div>


  
  
  <iframe src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/794.html" scrolling="no" width="468" height="60" frameborder="0"></iframe>
  
  <div id="bottoms" class="clearfix">
    <div id="digg_bottom" class="clearfix"><a href="http://nuysoft.iteye.com/blog/1178483#" onclick="digg(&quot;blogs&quot;, 1178483, false);return false;"><div><strong>6</strong> <br>顶</div></a><a href="http://nuysoft.iteye.com/blog/1178483#" onclick="digg(&quot;blogs&quot;, 1178483, true);return false;"><div><strong>0</strong> <br>踩</div></a></div>
    <div id="share_weibo">分享到：
      <a data-type="sina" href="javascript:;" title="分享到新浪微博"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/sina.jpg"></a>
      <a data-type="qq" href="javascript:;" title="分享到腾讯微博"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/tec.jpg"></a>
    </div>
  </div>

  <div class="blog_nav">
    <div class="pre_next">
      <a href="http://nuysoft.iteye.com/blog/1179369" class="next" title="程序员的呓语---不再孤单">程序员的呓语---不再孤单</a>
      |
      <a href="http://nuysoft.iteye.com/blog/1177459" class="pre" title="[原创] jQuery源码分析-00前言开光">[原创] jQuery源码分析-00前言开光</a>
    </div>
  </div>
  <div class="blog_bottom">
    <ul>
      <li>2011-09-23 00:09</li>
      <li>浏览 8907</li>
      <li><a href="http://nuysoft.iteye.com/blog/1178483#comments">评论(1)</a></li>
      
      
        <li><a href="http://nuysoft.iteye.com/admin/link?user_favorite%5Btitle%5D=%5B%E5%8E%9F%E5%88%9B%5D+jQuery%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-15AJAX-%E5%89%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E8%AF%B7%E6%B1%82%E5%88%86%E5%8F%91%E5%99%A8&user_favorite%5Burl%5D=http%3A%2F%2Fnuysoft.iteye.com%2Fblog%2F1178483" target="_blank" class="favorite" onclick="$$(&#39;.favorite_form_spinner&#39;)[0].show();new Ajax.Request(&#39;/admin/link/new_xhr?user_favorite%5Btitle%5D=%5B%E5%8E%9F%E5%88%9B%5D+jQuery%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-15AJAX-%E5%89%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E8%AF%B7%E6%B1%82%E5%88%86%E5%8F%91%E5%99%A8&amp;user_favorite%5Burl%5D=http%3A%2F%2Fnuysoft.iteye.com%2Fblog%2F1178483&#39;, {method: &#39;get&#39;, onSuccess: function(response){$(document.getElementsByTagName(&#39;body&#39;)[0]).insert({bottom:response.responseText});$$(&#39;.favorite_form_spinner&#39;)[0].hide();}});return false;">收藏</a><img alt="Spinner" class="favorite_form_spinner" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/spinner.gif" style="vertical-align:bottom;margin-left:7px;display:none;"></li>
      
      <li>分类:<a href="http://www.iteye.com/blogs/category/web">Web前端</a></li>      
      <li class="last"><a href="http://www.iteye.com/wiki/blog/1178483" target="_blank" class="more">相关推荐</a></li>
    </ul>
  </div>

  <div class="blog_comment">
    <h5>评论</h5>
    <a id="comments" name="comments"></a>
    <div id="bc2285737">
  <div class="comment_title">
    1 楼
    <a href="http://zhkzyth.iteye.com/" target="_blank" title="zhkzyth">zhkzyth</a>
    2012-10-18&nbsp;&nbsp;
    <a href="http://nuysoft.iteye.com/blog/1178483#" onclick="quote_comment(2285737);return false;">引用</a>
    
  </div>
  <div class="comment_content"><div class="dp-highlighter" id=""><div class="bar"><div class="tools">Java代码 <embed wmode="transparent" src="/javascripts/syntaxhighlighter/clipboard_new.swf" width="14" height="15" flashvars="clipboard=%20%20%20%20%20%20%20%2F%2F%20Clean-up%20function%0A%0A%20%20%20%20%20%20%20jqXHR.always(function()%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Set%20callback%20back%20to%20previous%20value%0A%0A%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%B0%86%E5%A4%87%E4%BB%BD%E7%9A%84previous%E5%87%BD%E6%95%B0%E6%81%A2%E5%A4%8D%0A%0A%20%20%20%20%20%20%20%20%20%20%20window%5B%20jsonpCallback%20%5D%20%3D%20previous%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Call%20if%20it%20was%20a%20function%20and%20we%20have%20a%20response%0A%0A%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%93%8D%E5%BA%94%E5%AE%8C%E6%88%90%E6%97%B6%E8%B0%83%E7%94%A8jsonp%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%EF%BC%8C%E9%97%AE%E9%A2%98%E6%98%AF%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%8D%E6%98%AF%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B9%88%EF%BC%9F%0A%0A%20%20%20%20%20%20%20%20%20%20%20if%20(%20responseContainer%20%26%26%20jQuery.isFunction(%20previous%20)%20)%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20window%5B%20jsonpCallback%20%5D(%20responseContainer%5B%200%20%5D%20)%3B%20%2F%2F%20%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%86%8D%E6%AC%A1%E6%89%A7%E8%A1%8Cprevious%E5%91%A2%EF%BC%9F%0A%0A%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%7D)%3B" quality="high" allowscriptaccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">&nbsp;<a href="javascript:void()" title="收藏这段代码" onclick="code_favorites_do_favorite(this);return false;"><img class="star" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_star.png" alt="收藏代码"><img class="spinner" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/spinner(1).gif" style="display:none"></a></div></div><ol start="1" class="dp-j"><li><span><span class="comment">//&nbsp;Clean-up&nbsp;function</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>jqXHR.always(function()&nbsp;{&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Set&nbsp;callback&nbsp;back&nbsp;to&nbsp;previous&nbsp;value</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;将备份的previous函数恢复</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;window[&nbsp;jsonpCallback&nbsp;]&nbsp;=&nbsp;previous;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Call&nbsp;if&nbsp;it&nbsp;was&nbsp;a&nbsp;function&nbsp;and&nbsp;we&nbsp;have&nbsp;a&nbsp;response</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;响应完成时调用jsonp回调函数，问题是这个函数不是自动执行的么？</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(&nbsp;responseContainer&nbsp;&amp;&amp;&nbsp;jQuery.isFunction(&nbsp;previous&nbsp;)&nbsp;)&nbsp;{&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window[&nbsp;jsonpCallback&nbsp;](&nbsp;responseContainer[&nbsp;<span class="number">0</span><span>&nbsp;]&nbsp;);&nbsp;</span><span class="comment">//&nbsp;为什么要再次执行previous呢？</span><span>&nbsp;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;</span></li><li><span>});&nbsp;&nbsp;</span></li></ol></div><pre class="java" name="code" codeable_id="2285737" codeable_type="BlogComment" source_url="http://nuysoft.iteye.com/blog/1178483#bc2285737" pre_index="0" title="[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器" style="display: none;">       // Clean-up function

       jqXHR.always(function() {

           // Set callback back to previous value

           // 将备份的previous函数恢复

           window[ jsonpCallback ] = previous;

           // Call if it was a function and we have a response

           // 响应完成时调用jsonp回调函数，问题是这个函数不是自动执行的么？

           if ( responseContainer &amp;&amp; jQuery.isFunction( previous ) ) {

              window[ jsonpCallback ]( responseContainer[ 0 ] ); // 为什么要再次执行previous呢？

           }

       });</pre><br><br><br>jqXHR.always的实现是说，不管当前这次的ajax请求是否成功，都要执行这个function，然后，如果是执行失败的话，而response数组里面又有内容的话，就用上一次的callback来执行一次，可能是某些优化的原因吧=.=....<br><br>分析还没看完，只是想法</div>
</div>


    
    
  </div>

  <div class="blog_comment">
    <h5>发表评论</h5>
            <form action="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站.html" id="comment_form" method="post" onsubmit="return false;"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="foncspGUjo88KbEH23TBNwmOVJHI8suaVg9RqM0afpk="></div>          


  <input type="hidden" id="editor_bbcode_flag" value="true">



<div id="editor_main"><div id="editor_wrapper" class="clearfix"><div id="bbcode_emotions"><h5>表情图标</h5><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_biggrin.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_smile.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_sad.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_surprised.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_eek.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_confused.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_cool.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_lol.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_mad.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_razz.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_redface.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_cry.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_evil.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_twisted.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_rolleyes.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_wink.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_exclaim.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_question.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_idea.gif"><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_arrow.gif"></div><div id="bbcode_controllers"><div id="bbcode_toolbar"><input type="button" value="B" id="button_bold"><input type="button" value="I" id="button_italic"><input type="button" value="U" id="button_underline"><input type="button" value="Quote"><input type="button" value="Code"><input type="button" value="List"><input type="button" value="Img"><input type="button" value="URL"><input type="button" value="Flash"><input type="button" value="Table"><br>字体颜色: <select id="select_color"><option value="black" style="color: black;">标准</option><option value="darkred" style="color: darkred;">深红</option><option value="red" style="color: red;">红色</option><option value="orange" style="color: orange;">橙色</option><option value="brown" style="color: brown;">棕色</option><option value="yellow" style="color: yellow;">黄色</option><option value="green" style="color: green;">绿色</option><option value="olive" style="color: olive;">橄榄</option><option value="cyan" style="color: cyan;">青色</option><option value="blue" style="color: blue;">蓝色</option><option value="darkblue" style="color: darkblue;">深蓝</option><option value="indigo" style="color: indigo;">靛蓝</option><option value="violet" style="color: violet;">紫色</option><option value="gray" style="color: gray;">灰色</option><option value="white" style="color: white;">白色</option><option value="black" style="color: black;">黑色</option></select>&nbsp;字体大小: <select id="select_font"><option value="0">标准</option><option value="xx-small">1 (xx-small)</option><option value="x-small">2 (x-small)</option><option value="small">3 (small)</option><option value="medium">4 (medium)</option><option value="large">5 (large)</option><option value="x-large">6 (x-large)</option><option value="xx-large">7 (xx-large)</option></select>&nbsp;对齐: <select id="select_align"><option value="0">标准</option><option value="left">居左</option><option value="center">居中</option><option value="right">居右</option></select></div><div id="bbcode_tooltip">提示：选择您需要装饰的文字, 按上列按钮即可添加上相应的标签</div><textarea class="validate-richeditor bad-words min-length-5" cols="40" id="editor_body" name="comment[body]" rows="20" style="width: 500px; height: 350px;"></textarea></div></div></div>


<script type="text/javascript">
  var editor = new Control.TextArea.Editor("editor_body", "bbcode", false);
</script>

          <p style="text-align:right;margin-right:30px;">(快捷键 Alt+S / Ctrl+Enter) <input class="submit" id="quick_reply_button" name="commit" type="submit" value="提交"></p>
       </form>
        <script type="text/javascript">
          new HotKey("s",function() {$('quick_reply_button').click();},{altKey: true, ctrlKey: false});
          new HotKey(new Number(13),function() {$('quick_reply_button').click();},{altKey: false, ctrlKey: true});

          new Validation("comment_form", {immediate: false, onFormValidate: function(result, form){
            if(result) {
              new Ajax.Request('/blog/create_comment/1178483', {
                onFailure:function(response){
                  $('comments').insert({after:response.responseText})
                  form.spinner.hide();
                  Element.scrollTo($('comments'));
                },
                onSuccess:function(response){
                  Element.scrollTo($('comments'));
                  var new_comment = new Element('div', {}).update(response.responseText).firstChild;
                  var comment_id = new_comment.readAttribute('id');

                  $('comments').insert({after:response.responseText});
                  $('editor_body').value = "";

                  var css_rules = '#' + comment_id + ' pre';
                  highlightNewAddContent(css_rules);
                  processComment();
                  code_favorites_init(css_rules);
                  
                  form.spinner.hide();
                }, parameters:Form.serialize(form)
              });
            }
        }});
        </script>
        </div>
</div>


<script type="text/javascript">
  dp.SyntaxHighlighter.HighlightAll('code', true, true);

  $$('#main .blog_content pre[name=code]').each(function(pre, index){ // blog content
    var post_id = 1178483;
    var location = window.location;
    source_url = location.protocol + "//" + location.host + location.pathname + location.search;
    pre.writeAttribute('codeable_id', post_id);
    pre.writeAttribute('codeable_type', "Blog");
    pre.writeAttribute('source_url', source_url);
    pre.writeAttribute('pre_index', index);
    pre.writeAttribute('title', '[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器');
  });

  fix_image_size($$('div.blog_content img'), 700);

  function processComment() {
    $$('#main .blog_comment > div').each(function(comment){// comment
      var post_id = comment.id.substr(2);
      $$("#"+comment.id+" pre[name=code]").each(function(pre, index){
        var location = window.location;
        source_url = location.protocol + "//" + location.host + location.pathname + location.search;
        source_url += "#" + comment.id;
        pre.writeAttribute('codeable_id', post_id);
        pre.writeAttribute('codeable_type', "BlogComment");
        pre.writeAttribute('source_url', source_url);
        pre.writeAttribute('pre_index', index);
        pre.writeAttribute('title', '[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器');
      });
    });
  }

  function quote_comment(id) {
    new Ajax.Request('/editor/quote', {
      parameters: {'id':id, 'type':'BlogComment'},
      onSuccess:function(response){editor.bbcode_editor.textarea.insertAfterSelection(response.responseText);
        Element.scrollTo(editor.bbcode_editor.textarea.element);}
    });
  }

  code_favorites_init();
  processComment();
  new WeiboShare({share_buttons: $('share_weibo'), img_scope: $('blog_content')});
</script>




        </div>

        <div id="local">
          <div class="local_top"></div>
          <div id="blog_owner">
  <div id="blog_owner_logo"><a href="http://nuysoft.iteye.com/"><img alt="nuysoft的博客" class="logo" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/d6b532d5-b30d-3a42-8336-611f8b83dfd6.jpg" title="nuysoft的博客: nuysoft" width=""></a></div>
  <div id="blog_owner_name">nuysoft</div>
</div>

          <div id="blog_actions">
            <ul>
              <li>浏览: 349123 次</li>
              <li>性别: <img alt="Icon_minigender_1" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/icon_minigender_1.gif" title="男"></li>
              <li>来自: 北京</li>
              <li><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/offline.gif"></li>
              
                <li>
                  <a href="http://my.iteye.com/messages/new?message%5Breceiver_name%5D=nuysoft" class="message" title="发送站内短信">发短消息</a>
                  
                    <a href="http://my.iteye.com/feed/772224" class="subscription" onclick="if (confirm(&#39;你确定要取消这个关注？&#39;)) { var f = document.createElement(&#39;form&#39;); f.style.display = &#39;none&#39;; this.parentNode.appendChild(f); f.method = &#39;POST&#39;; f.action = this.href;var m = document.createElement(&#39;input&#39;); m.setAttribute(&#39;type&#39;, &#39;hidden&#39;); m.setAttribute(&#39;name&#39;, &#39;_method&#39;); m.setAttribute(&#39;value&#39;, &#39;delete&#39;); f.appendChild(m);var s = document.createElement(&#39;input&#39;); s.setAttribute(&#39;type&#39;, &#39;hidden&#39;); s.setAttribute(&#39;name&#39;, &#39;authenticity_token&#39;); s.setAttribute(&#39;value&#39;, &#39;foncspGUjo88KbEH23TBNwmOVJHI8suaVg9RqM0afpk=&#39;); f.appendChild(s);f.submit(); };return false;">取消关注</a>
                  
                </li>
              
            </ul>
          </div>
          <div id="user_visits" class="clearfix">
            <h5>最近访客 <span style="font-weight:normal;font-size:12px;padding-left:30px;"><a href="http://nuysoft.iteye.com/blog/user_visits">更多访客&gt;&gt;</a></span></h5>
            
              <div class="user_visit">
                <div class="logo"><a href="http://hhy5277.iteye.com/" target="_blank"><img alt="hhy5277的博客" class="logo" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/user-logo-thumb.gif" title="hhy5277的博客: " width="48px"></a></div>
                <div class="left"><a href="http://hhy5277.iteye.com/" target="_blank" title="hhy5277">hhy5277</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href="http://dylinshi126.iteye.com/" target="_blank"><img alt="dylinshi126的博客" class="logo" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/user-logo-thumb.gif" title="dylinshi126的博客: " width="48px"></a></div>
                <div class="left"><a href="http://dylinshi126.iteye.com/" target="_blank" title="dylinshi126">dylinshi126</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href="http://hxlhuangxiaolong-yahoo-cn.iteye.com/" target="_blank"><img alt="诚信天下hxl的博客" class="logo" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/f7552907-3258-3880-858e-5631bb20d923-thumb.jpg" title="诚信天下hxl的博客: " width="48px"></a></div>
                <div class="left"><a href="http://hxlhuangxiaolong-yahoo-cn.iteye.com/" target="_blank" title="诚信天下hxl">诚信天下hxl</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href="http://wyxzhsh.iteye.com/" target="_blank"><img alt="wyxzhsh的博客" class="logo" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/531e8f8d-4594-33e3-aacb-68bcbca9fa06-thumb.jpg" title="wyxzhsh的博客: " width="48px"></a></div>
                <div class="left"><a href="http://wyxzhsh.iteye.com/" target="_blank" title="wyxzhsh">wyxzhsh</a></div>
              </div>
            
          </div>

          
            <div>
              <h5>博客专栏</h5>
              

  
  <dl class="series" style="padding-bottom:5px;">
    <dt>
      <a href="http://www.iteye.com/blogs/subjects/jquery" target="_blank"><img alt="91bd5d30-bd1e-3b00-9210-87db1cca0016" src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/91bd5d30-bd1e-3b00-9210-87db1cca0016.png"></a>
    </dt>
    <dd>
    <a href="http://www.iteye.com/blogs/subjects/jquery" target="_blank" title="jQuery技术内幕">jQuery技术内幕</a><br>
      <span class="visited">浏览量：136964</span>
    </dd>
  </dl>
  


            </div>
          

                      <div id="blog_menu">
              <h5>文章分类</h5>
              <ul>
                <li><a href="http://nuysoft.iteye.com/">全部博客 (36)</a></li>
                
                  <li><a href="http://nuysoft.iteye.com/category/99537">天天向上 (10)</a></li>
                
                  <li><a href="http://nuysoft.iteye.com/category/116143">项目管理 (2)</a></li>
                
                  <li><a href="http://nuysoft.iteye.com/category/116144">Java (1)</a></li>
                
                  <li><a href="http://nuysoft.iteye.com/category/136360">读书笔记 (0)</a></li>
                
                  <li><a href="http://nuysoft.iteye.com/category/140986">jQuery (24)</a></li>
                
              </ul>
            </div>
            <div id="month_blogs">
              <h5>社区版块</h5>
              <ul>
                <li><a href="http://nuysoft.iteye.com/blog/news">我的资讯</a> (0)</li>
                <li>
                  <a href="http://nuysoft.iteye.com/blog/post">我的论坛</a> (1)
                </li>
                <li><a href="http://nuysoft.iteye.com/blog/answered_problems">我的问答</a> (0)</li>
              </ul>
            </div>
            <div id="month_blogs">
              <h5>存档分类</h5>
              <ul>
                
                  <li><a href="http://nuysoft.iteye.com/blog/monthblog/2011-11">2011-11</a> (3)</li>
                
                  <li><a href="http://nuysoft.iteye.com/blog/monthblog/2011-10">2011-10</a> (11)</li>
                
                  <li><a href="http://nuysoft.iteye.com/blog/monthblog/2011-09">2011-09</a> (14)</li>
                
                <li><a href="http://nuysoft.iteye.com/blog/monthblog_more">更多存档...</a></li>
              </ul>
            </div>
            
            

            <div id="guest_books">
              <h5>最新评论</h5>
              <ul>
                
                <li>
                  <a href="http://niuqiang2008.iteye.com/" target="_blank" title="niuqiang2008">niuqiang2008</a>： 
                   学习学习&nbsp;&nbsp;&nbsp;&nbsp;<br>
                  <a href="http://nuysoft.iteye.com/blog/1256338#bc2362322">[原创] jQuery源码分析-04 选择器-Sizzle-工作原理</a>
                </li>
                
                <li>
                  <a href="http://liuweihug.iteye.com/" target="_blank" title="liuweihug">liuweihug</a>： 
                  jquery 解析正则表达式及常见的Regex规则和表达式 - ...<br>
                  <a href="http://nuysoft.iteye.com/blog/1217898#bc2356306">[原创] jQuery源码分析-02正则表达式-RegExp-常用正则表达式</a>
                </li>
                
                <li>
                  <a href="http://liang8768.iteye.com/" target="_blank" title="liang8768">liang8768</a>： 
                  mark!!!<br>
                  <a href="http://nuysoft.iteye.com/blog/1177459#bc2352219">[原创] jQuery源码分析-00前言开光</a>
                </li>
                
                <li>
                  <a href="http://levinqdl.iteye.com/" target="_blank" title="levinqdl">levinqdl</a>： 
                  viewsoft 写道“// fail”均调用不到fn tes ...<br>
                  <a href="http://nuysoft.iteye.com/blog/1177451#bc2351119">[原创] jQuery源码分析-01总体架构</a>
                </li>
                
                <li>
                  <a href="http://perwarz.iteye.com/" target="_blank" title="perwarz">perwarz</a>： 
                  为什么$("")返回的会是一个数组？搞了好 ...<br>
                  <a href="http://nuysoft.iteye.com/blog/1177451#bc2337964">[原创] jQuery源码分析-01总体架构</a>
                </li>
                
              </ul>
            </div>

            <div class="local_bottom"></div>
          
        </div>
      </div>

      <div id="footer" class="clearfix">
        <div id="copyright">
          <hr>
          声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。<br>
          © 2003-2015 ITeye.com.   All rights reserved.  [ 京ICP证110151号  京公网安备110105010620 ]
        </div>
      </div>
    </div>
    <script type="text/javascript">
  document.write("<img src='http://stat.iteye.com/?url="+ encodeURIComponent(document.location.href) + "&referrer=" + encodeURIComponent(document.referrer) + "&user_id=317070' width='0' height='0' />");
</script><img src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/saved_resource" width="0" height="0">

<script src="./[原创] jQuery源码分析-15AJAX-前置过滤器和请求分发器 - nuysoft - ITeye技术网站_files/tracking.js" type="text/javascript"></script>

    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20906367-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
      
    
  

</body></html>